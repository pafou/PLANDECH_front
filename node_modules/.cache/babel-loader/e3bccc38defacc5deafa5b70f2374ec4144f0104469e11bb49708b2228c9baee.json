{"ast":null,"code":"import React,{useEffect,useState}from'react';import{API_BASE_URL}from'../apiConfig';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const UserSelect=()=>{const[users,setUsers]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const[selectedUser,setSelectedUser]=useState('');const[token,setToken]=useState(null);useEffect(()=>{fetch(\"\".concat(API_BASE_URL,\"/api/persons\")).then(response=>{if(!response.ok){throw new Error('Network response was not ok');}return response.json();}).then(data=>{setUsers(data);setLoading(false);}).catch(error=>{setError(error.message);setLoading(false);});},[]);const handleUserChange=event=>{const selectedUser=users.find(user=>\"\".concat(user.name,\" \").concat(user.firstname)===event.target.value);if(selectedUser){fetch(\"\".concat(API_BASE_URL,\"/api/generate-token\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({userId:selectedUser.id_pers})}).then(response=>{if(!response.ok){throw new Error(\"Network response was not ok Buddy: \".concat(JSON.stringify(selectedUser.id_pers)));}return response.json();}).then(data=>{setToken(data.token);localStorage.setItem('jwtToken',data.token);setSelectedUser(event.target.value);window.location.reload();// Refresh the page\n}).catch(error=>{setError(error.message);});}else{setSelectedUser(event.target.value);}};if(loading){return/*#__PURE__*/_jsx(\"div\",{children:\"Loading users...\"});}if(error){return/*#__PURE__*/_jsxs(\"div\",{children:[\"Error: \",error]});}return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"user-select\",children:\"Select User: \"}),/*#__PURE__*/_jsxs(\"select\",{id:\"user-select\",value:selectedUser,onChange:handleUserChange,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"--Please choose a user--\"}),users.map(user=>/*#__PURE__*/_jsxs(\"option\",{value:\"\".concat(user.name,\" \").concat(user.firstname),children:[user.name,\" \",user.firstname]},user.id_pers))]}),selectedUser&&/*#__PURE__*/_jsxs(\"p\",{children:[\"Selected: \",selectedUser]}),token&&/*#__PURE__*/_jsxs(\"p\",{children:[\"Token: \",token]})]});};export default UserSelect;","map":{"version":3,"names":["React","useEffect","useState","API_BASE_URL","jsx","_jsx","jsxs","_jsxs","UserSelect","users","setUsers","loading","setLoading","error","setError","selectedUser","setSelectedUser","token","setToken","fetch","concat","then","response","ok","Error","json","data","catch","message","handleUserChange","event","find","user","name","firstname","target","value","method","headers","body","JSON","stringify","userId","id_pers","localStorage","setItem","window","location","reload","children","htmlFor","id","onChange","map"],"sources":["/Users/pascal/workspace/plan_de_charge/front/src/components/UserSelect.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { API_BASE_URL } from '../apiConfig';\n\ninterface User {\n  id_pers: number;\n  name: string;\n  firstname: string;\n}\n\nconst UserSelect: React.FC = () => {\n  const [users, setUsers] = useState<User[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [selectedUser, setSelectedUser] = useState<string>('');\n  const [token, setToken] = useState<string | null>(null);\n\n  useEffect(() => {\n    fetch(`${API_BASE_URL}/api/persons`)\n      .then((response) => {\n        if (!response.ok) {\n          throw new Error('Network response was not ok');\n        }\n        return response.json();\n      })\n      .then((data) => {\n        setUsers(data);\n        setLoading(false);\n      })\n      .catch((error) => {\n        setError(error.message);\n        setLoading(false);\n      });\n  }, []);\n\n  const handleUserChange = (event: React.ChangeEvent<HTMLSelectElement>) => {\n    const selectedUser = users.find(\n      (user) => `${user.name} ${user.firstname}` === event.target.value\n    );\n\n    if (selectedUser) {\n      fetch(`${API_BASE_URL}/api/generate-token`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ userId: selectedUser.id_pers }),\n      })\n        .then((response) => {\n          if (!response.ok) {\n            throw new Error(`Network response was not ok Buddy: ${JSON.stringify(selectedUser.id_pers)}`);\n          }\n          return response.json();\n        })\n        .then((data) => {\n          setToken(data.token);\n          localStorage.setItem('jwtToken', data.token);\n          setSelectedUser(event.target.value);\n          window.location.reload(); // Refresh the page\n        })\n        .catch((error) => {\n          setError(error.message);\n        });\n    } else {\n      setSelectedUser(event.target.value);\n    }\n  };\n\n  if (loading) {\n    return <div>Loading users...</div>;\n  }\n\n  if (error) {\n    return <div>Error: {error}</div>;\n  }\n\n  return (\n    <div>\n      <label htmlFor=\"user-select\">Select User: </label>\n      <select id=\"user-select\" value={selectedUser} onChange={handleUserChange}>\n        <option value=\"\">--Please choose a user--</option>\n        {users.map((user) => (\n          <option key={user.id_pers} value={`${user.name} ${user.firstname}`}>\n            {user.name} {user.firstname}\n          </option>\n        ))}\n      </select>\n      {selectedUser && <p>Selected: {selectedUser}</p>}\n      {token && <p>Token: {token}</p>}\n    </div>\n  );\n};\n\nexport default UserSelect;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}